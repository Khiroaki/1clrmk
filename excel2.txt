&НаСервере
Процедура ЗагрузкаДанныхИзФайлаНаСервере(ТабДок, ПутьКФайлу)
	ТабДок.Прочитать(ПутьКФайлу, СпособЧтенияЗначенийТабличногоДокумента.Значение);
	ПостроительЗапроса = Новый ПостроительЗапроса;
	ПостроительЗапроса.ИсточникДанных = Новый ОписаниеИсточникаДанных(ТабДок.Область("Книги"));
	ПостроительЗапроса.Выполнить();
	ТаблицаКнигИзФайла = ПостроительЗапроса.Результат.Выгрузить();
	Для Каждого ДанныеКниги Из ТаблицаКнигИзФайла Цикл
		// Способ обработки справочников без запроса
		Запрос = Справочники.Автор.НайтиПоНаименованию(ДанныеКниги.Автор);
		Если Запрос.Наименование <> ДанныеКниги.Автор Тогда // Обработка Справочника Автор       
			НовыйАвтор = Справочники.Автор.СоздатьЭлемент();
			НовыйАвтор.Наименование = ДанныеКниги.Автор;
		    НовыйАвтор.Записать();		
		КонецЕсли;
		Запрос = Справочники.Страна.НайтиПоНаименованию(ДанныеКниги.Страна);
		Если Запрос.Наименование <> ДанныеКниги.Страна Тогда // Обработка Справочника Страна       
			НоваяСтрана = Справочники.Страна.СоздатьЭлемент();
			НоваяСтрана.Наименование = ДанныеКниги.Страна;
		    НоваяСтрана.Записать();
		КонецЕсли;
		Запрос = Справочники.Тип.НайтиПоНаименованию(ДанныеКниги.Тип);
		Если Запрос.Наименование <> ДанныеКниги.Тип Тогда // Обработка Справочника Тип       
			НовыйТип = Справочники.Тип.СоздатьЭлемент(); 
			НовыйТип.Наименование = ДанныеКниги.Тип;
		    НовыйТип.Записать();
		КонецЕсли;
		Запрос = Справочники.Издание.НайтиПоНаименованию(ДанныеКниги.Издание);
		Если Запрос.Наименование <> ДанныеКниги.Издание Тогда // Обработка Справочника Издание       
			НовоеИздание = Справочники.Издание.СоздатьЭлемент(); 
			НовоеИздание.Наименование = ДанныеКниги.Издание;
		    НовоеИздание.Записать();
		КонецЕсли;
		Запрос = Справочники.Формат.НайтиПоНаименованию(ДанныеКниги.Формат);
		Если Запрос.Наименование <> ДанныеКниги.Формат Тогда // Обработка Справочника Формат       
			НовоеИздание = Справочники.Формат.СоздатьЭлемент(); 
			НовоеИздание.Наименование = ДанныеКниги.Формат;
		    НовоеИздание.Записать();
		КонецЕсли;
		Запрос = Справочники.Ценность.НайтиПоНаименованию(ДанныеКниги.Ценность);
		Если Запрос.Наименование <> ДанныеКниги.Ценность Тогда // Обработка Справочника Ценность       
			НовоеИздание = Справочники.Ценность.СоздатьЭлемент(); 
			НовоеИздание.Наименование = ДанныеКниги.Ценность;
		    НовоеИздание.Записать();
		КонецЕсли;
		НоваяКнига = Справочники.Книги.СоздатьЭлемент();
		//ИсключитьПД = Документы.Книги.НайтиПоРеквизиту("Название", ДанныеКниги.Название);
		ИсключитьПД = Справочники.Книги.НайтиПоНаименованию(ДанныеКниги.Название);
		Если ИсключитьПД.Наименование <> ДанныеКниги.Название Тогда 
			//НоваяКнига.Дата = ТекущаяДата();
			Если Выборка = Истина Тогда
				ОбработатьПоложениеКниги(ДанныеКниги);	
			КонецЕсли;
			ДатаДок = ДанныеКниги.Год;
			Год = Число(Прав(ДатаДок, 5));
			Месяц = 1;
			День = 1;
			ДатаДок = Дата(Год, Месяц, День, 0, 0, 0);
			НоваяКнига.Год = ДатаДок;
			//НоваяКнига.Название = ДанныеКниги.Название;
			НоваяКнига.Наименование = ДанныеКниги.Название;
			НоваяКнига.Год = ДанныеКниги.Год;
			НоваяКнига.Автор = Справочники.Автор.НайтиПоНаименованию(ДанныеКниги.Автор);
			НоваяКнига.Страна = Справочники.Страна.НайтиПоНаименованию(ДанныеКниги.Страна);
			НоваяКнига.Тип = Справочники.Тип.НайтиПоНаименованию(ДанныеКниги.Тип);
			НоваяКнига.Издание = Справочники.Издание.НайтиПоНаименованию(ДанныеКниги.Издание);
			НоваяКнига.Формат = Справочники.Формат.НайтиПоНаименованию(ДанныеКниги.Формат);
			НоваяКнига.Примечание = ДанныеКниги.Примечание;
			НоваяКнига.Описание = ДанныеКниги.Описание;
			НоваяКнига.КоличествоСтраниц = ДанныеКниги.Количество;
			НоваяКнига.Ценность = Справочники.Ценность.НайтиПоНаименованию(ДанныеКниги.Ценность);
			НоваяКнига.Записать();
		Иначе
			Сообщить("Обнаружена книга-двойник");
		КонецЕсли;
	КонецЦикла;
	Сообщить("Выгрузка Завершена");
КонецПроцедуры

&НаСервере
Процедура ОбработатьПоложениеКниги(ДанныеКниги)
	Сообщить(ДанныеКниги.Автор);	
КонецПроцедуры

&НаКлиенте
Процедура ПутьКФайлуНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	Оповещение = Новый ОписаниеОповещения("ЗагрузкаДанныхВСправочник", ЭтотОбъект);
	НачатьПомещениеФайла(Оповещение,,, Истина, УникальныйИдентификатор);
КонецПроцедуры

&НаКлиенте
Процедура ЗагрузкаДанныхВСправочник(Результат, Адрес, ВыбранноеИмяФайла, ДополнительныеПараметры) Экспорт
	Если Не Результат Тогда
		Возврат;
	КонецЕсли;
	ПутьКФайлу = ВыбранноеИмяФайла;
КонецПроцедуры

&НаКлиенте
Процедура ЗагрузкаДанныхИзФайла(Команда)
	ТабДок = Новый ТабличныйДокумент;
	ЗагрузкаДанныхИзФайлаНаСервере(ТабДок, ПутьКФайлу);
КонецПроцедуры
